/*
 * presentr.js 1.0.0
 * 
 * https://github.com/oodzchen/presentr.js
 * Copyright 2015, Lin Chen
 *
 * MIT License
 *
 */
!function(t){"use strict";var e=function(a,r){function l(){c(),d(),(options.navigation.elements||options.navigation.elements.length>0)&&n.init(tt),options.enableHash?i.init(tt):P(options.startIndex)}function c(){var t={width:options.width+"px",height:options.height+"px"},e=h(options.effect);if(t=o.extend(t,e),W=document.createElement("div"),o.setStyle(X,{position:"relative",overflow:"hidden",visibility:"hidden"}),o.setStyle(W,{position:"absolute",left:0,top:0,width:"100%",height:"100%"}),U.forEach(function(e){o.setStyle(e,t),W.appendChild(e)}),X.appendChild(W),U=B.call(W.children),tt.slides=U,"slide"===options.effect&&options.cycle){var n=U[0].cloneNode(!0),i=U[G].cloneNode(!0);n.removeAttribute("data-hash"),i.removeAttribute("data-hash"),W.insertBefore(i,W.firstChild),W.appendChild(n),o.setStyle(W,{left:-options.width+"px",width:3*options.width+"px"})}setTimeout(function(){X.style.visibility=""},0)}function h(t){var e;switch(t){case"slide":e={display:"none","float":"left"};break;case"fade":e={position:"absolute",left:0,top:0,opacity:0};break;case"none":e={position:"absolute",left:0,top:0,display:"none"};break;default:e={display:"none","float":"left"}}return e}function d(){W.addEventListener(K.touchstart,f,!1)}function f(t){if(t.preventDefault(),t.stopPropagation(),at!==st.both){if(nt=J?t.touches[0].pageX:t.pageX,rt){if("slide"!==options.effect)return;N(),it=Number(W.style[$].match(/matrix\(1,\s?0,\s?0,\s?1,\s?(.*?),\s?0\)/)[1]),nt-=it}options.actionArea.addEventListener(K.touchmove,p,!1),options.actionArea.addEventListener(K.touchend,u,!1),options.actionArea.addEventListener(K.touchleave,u,!1)}}function p(t){var e=J?t.touches[0].pageX:t.pageX,n=e-nt;return ot=n-it,it=n,t.preventDefault(),t.stopPropagation(),"slide"===options.effect?it>0&&at===st.left||0>it&&at===st.right?(options.actionArea.removeEventListener(K.touchmove,p,!1),options.actionArea.removeEventListener(K.touchend,u,!1),void options.actionArea.removeEventListener(K.touchleave,u,!1)):void(W.style[$]="matrix(1, 0, 0, 1, "+it+", 0)"):void 0}function u(t){var e=parseInt(options.width/3),n=O();if(t.preventDefault(),t.stopPropagation(),0!==it){var i=0===ot?options.speed:100*(100-R)/ot;!options.cycle&&(0===n&&it>0||n===G&&0>it)?y():Math.abs(ot)<=R?Math.abs(it)>e?v(i):y():v(i)}nt=0,it=0,ot=0,options.actionArea.removeEventListener(K.touchmove,p,!1),options.actionArea.removeEventListener(K.touchend,u,!1),options.actionArea.removeEventListener(K.touchleave,u,!1)}function v(t){var e=Math.abs(t);e>options.speed&&(e=options.speed),it>0?m(e):g(e)}function y(){var t=O();_[options.effect](t)}function g(t){var e=O();_[options.effect](e+1,t)}function m(t){var e=O();_[options.effect](e-1,t)}function x(t,e){var n=O(),i=e||options.speed,o=options.width,s=S(t);null!==s&&(n===t?o=0:t>n&&(o=-o),rt||(C(s,n),rt=!0,H(W,{transform:"matrix(1, 0, 0, 1, "+o+", 0)"},i,function(){rt=!1,Q&&(W.style.width=options.width*q+1+"px",setTimeout(function(){W.style.width=options.width*q+"px"},0)),W.style[$]="matrix(1, 0, 0, 1, 0, 0)",P(s)})))}function b(t,e){var n=O(),i=e||options.speed,o=S(t);null!==o&&n!==o&&(rt||(C(o,n),rt=!0,H(U[n],{opacity:0},i),H(U[o],{opacity:1},i,function(){rt=!1,P(o)})))}function w(t){var e=O(),n=S(t);C(n,e),P(n)}function C(t,e){n.initialized&&n.update(t),"function"==typeof options.onChangeStart&&options.onChangeStart.call(tt,t,e)}function E(t){n.initialized&&n.update(t),"function"==typeof options.onChangeEnd&&options.onChangeEnd.call(tt,t)}function S(t){var e=t;if(-1>e||e>G+1)return null;if(-1===e){if(!options.cycle)return null;e=G}else if(e===G+1){if(!options.cycle)return null;e=0}return e}function A(t,e){var n=O(),o="string"==typeof t&&options.enableHash?i.hashToIndex(t):t;o===n||0>o||o>G||rt||("slide"===options.effect&&(n>o?(U[n-1].style.display="none",U[o].style.display=""):(U[n+1].style.display="none",U[o].style.display="")),_[options.effect](o,e))}function L(t){var e=st[t];if(0===arguments.length)e=st.both;else if(e===at||!st.hasOwnProperty(t))return!1;at=e}function T(t){var e=st[t];if(0===arguments.length)e=st.both;else if(!st.hasOwnProperty(t))return!1;return at===st.both-e?!1:void(at=e>=at?0:at-e)}function P(t){var e,n,o="string"==typeof t&&options.enableHash?i.hashToIndex(t):t,s=U[o],a=[],r=W.children;if(!s)return!1;if("slide"===options.effect){t>0?(n=U[o-1],a.push(n),r[0].style.display="none"):r[0].style.display="",a.push(s),G>t?(e=U[o+1],a.push(e),r[r.length-1].style.display="none"):r[r.length-1].style.display="";var l=I();l.forEach(function(t){t.classList.remove(options.activeClassName),-1===a.indexOf(t)&&(t.style.display="none")}),options.cycle||(W.style.left=-options.width*a.indexOf(s)+"px",W.style.width=options.width*a.length+"px"),s.classList.add(options.activeClassName),a.forEach(function(t){t.style.display=""})}else{var c=O();U[c].classList.remove(options.activeClassName),s.classList.add(options.activeClassName),"fade"===options.effect?s.style.opacity=1:(U[c].style.display="none",s.style.display="")}options.enableHash&&i.setHash(o),E(t)}function H(t,e,n,i){t.style[V]="all "+n+"ms "+options.timingFunction,et=function s(e){t.style[V]="","function"==typeof i&&i.call(t),t.removeEventListener(Z,s,!1)},t.addEventListener(Z,et,!1),o.setStyle(t,e)}function N(e,n){rt&&(W.removeEventListener(Z,et,!1),e||(W.style[$]=t.getComputedStyle(W,null)[$],arguments.length>1&&(n?et():(W.style[$]="matrix(1, 0, 0, 1, 0, 0)",it=0))),W.style[V]="",rt=!1)}function I(){var t=O();return[U[t-1],U[t],U[t+1]].filter(function(t){return!!t})}function O(){for(var t=0;q>t;t++)if(U[t].classList.contains(options.activeClassName))return t;return 0}function M(e){if(!lt){W.style[$]="matrix(1, 0, 0, 1, 0, 0)",W.style[V]="",s.data("old-config",o.clone(options,!0)),s.data("container-style",X.style.cssText),s.data("innerbox-style",W.style.cssText);var n=options.height=t.innerHeight,i=options.width=t.innerWidth;lt=!0,o.setStyle(X,{position:"fixed",left:0,top:0,height:n+"px",width:i+"px",zIndex:e||999}),j()}}function k(){lt&&(options=s.data("old-config"),lt=!1,X.style.cssText=s.data("container-style"),W.style.cssText=s.data("innerbox-style"),j())}function z(){return lt}function j(){var t={width:options.width+"px",height:options.height+"px"},e=O(),n=h(options.effect);t=o.extend(t,n),B.call(W.children).forEach(function(e){o.setStyle(e,t)}),"slide"===options.effect&&options.cycle&&o.setStyle(W,{left:-options.width+"px",width:3*options.width+"px"}),P(e)}function D(){F(),options.actionArea.removeEventListener(K.touchstart,f,!1),n.initialized&&n.destroy(),options.enableHash&&i.destroy()}function F(){for(;X.firstChild;)X.removeChild(X.firstChild);X.removeAttribute("style"),U.forEach(function(t){t.removeAttribute("style"),t.classList.remove(options.activeClassName),X.appendChild(t)})}if(!(this instanceof e))return new e(a,r);var W,X=a,B=Array.prototype.slice,U=B.call(a.children),q=U.length,G=q-1,J="ontouchstart"in t,K=J?{touchstart:"touchstart",touchmove:"touchmove",touchend:"touchend",touchleave:"touchleave"}:{touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",touchleave:"mouseleave"},Q=function(){var t=navigator.userAgent.match(/Android/i)&&navigator.userAgent.match(/Chrome\/(\d+)/i);return(!!t&&t[1])>40}(),R=1,V=({width:X.offsetWidth,height:X.offsetHeight,startIndex:1,cycle:!1,speed:300,lock:!1,timingFunction:"ease",effect:"slide",activeClassName:"presentr-active",navigation:{elements:[],eventType:"click",activeClassName:"presentr-nav-active"},enableHash:!0,actionArea:document,onChangeStart:function(t,e){},onChangeEnd:function(t){}},o.getPrefixedCSS("transition")),Y={MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",MSTransition:"MSTransitionEnd",transition:"transitionend"},Z=Y[V],$=o.getPrefixedCSS("transform");if(null!==V&&null!==$){var _={slide:x,fade:b,none:w},tt=o.extend(this,{show:P,prev:m,next:g,lock:L,unLock:T,gotoSlide:A,getIndex:O,fullScreen:M,cancelFullScreen:k,isFullScreen:z,destroy:D});tt.options=options;var et,nt=0,it=0,ot=0,st={"false":0,left:1,right:2,"true":3,both:3},at=st[options.lock],rt=!1,lt=!1;return l(),tt}},n={initialized:!1,init:function(t){var e=this;e.config=t.options.navigation,e.elements=e.config.elements,e.presentr=t,e.elements&&0!==e.elements.length&&(Array.prototype.slice.call(e.elements).forEach(function(t,n){t.setAttribute("data-index",n),t.addEventListener(e.config.eventType,e.eventHandler,!1)}),e.update(),e.initialized=!0)},eventHandler:function(t){var e=Number(this.getAttribute("data-index"));t.preventDefault(),presentr.gotoSlide(e)},getIndex:function(){var t,e=this.elements.length;for(t=0;e>t;t++)if(this.elements[t].classList.contains(this.config.activeClassName))return t;return 0},update:function(t){if(0!==this.elements.length){var e=arguments.length>0?t:this.presentr.getIndex();this.elements[this.getIndex()].classList.remove(this.config.activeClassName),this.elements[e].classList.add(this.config.activeClassName)}},destroy:function(){var t=this;t.initialized&&(Array.prototype.slice.call(t.elements).forEach(function(e,n){e.removeAttribute("data-index"),e.classList.remove(t.config.activeClassName),e.removeEventListener(t.config.eventType,t.eventHandler,!1)}),t.initialized=!1)}},i={init:function(e){var n=this,i=t.location.hash.replace("#",""),o={};n.presentr=e,n.hashes=e.slides.map(function(t,e){return t.getAttribute("data-hash")||String(e)}),n.hashes.forEach(function(t,e){o[t]=e,o[e]=e,n.presentr.slides[e].setAttribute("data-hash",t)}),n.hashMap=o,n.hashMap.hasOwnProperty(i)?n.presentr.show(n.hashToIndex(i)):(n.presentr.show(n.presentr.options.startIndex),t.location.hash=n.hashes[n.presentr.options.startIndex]),n.addEvent()},setHash:function(e){var n=t.location.hash.replace("#","");this.hashToIndex(n)!==e&&(this.removeEvent(),t.location.hash=this.hashes[e],this.addEvent())},onHashChange:function(e){var n=t.location.hash.replace("#","");this.hashMap.hasOwnProperty(n)&&(this.presentr.gotoSlide(this.hashToIndex(n)),e.stopImmediatePropagation())},hashToIndex:function(t){return this.hashMap[t]},addEvent:function(){this.onHashChange=this.onHashChange.bind(this),t.addEventListener("hashchange",this.onHashChange,!1)},removeEvent:function(){t.removeEventListener("hashchange",this.onHashChange,!1)},destroy:function(){var t=this;t.hashes.forEach(function(e,n){t.presentr.slides[n].removeAttribute("data-hash")}),t.removeEvent()}},o={extend:function(t,e,n){var i=t;for(var o in e)if(e.hasOwnProperty(o)){var s=e[o];!n||"object"!=typeof s||s instanceof Node?i[o]=e[o]:i[o]=this.extend(i[o],s,n)}return i},clone:function(t,e){var n={};if("object"!=typeof t||t instanceof Node)return t;t instanceof Array&&(n=[]);for(var i in t){var o=t[i];t.hasOwnProperty(i)&&(e&&"object"==typeof o?n[i]=this.clone(o,e):n[i]=o)}return n},setStyle:function(t,e){var n=this.getPrefixedCSSObj(e);o.extend(t.style,n)},getPrefixedCSSObj:function(t){var e,n;for(n in t)if(t.hasOwnProperty(n)){if(e=this.getPrefixedCSS(n),e===n||null===e)continue;t[e]=t[n],delete t.prop}return t},getPrefixedCSS:function(t){var e,n,i=document.body.style,o=t,s=["Moz","Webkit","O","MS","ms"],a=o.charAt(0).toUpperCase()+o.slice(1);if(o in i)return o;for(n=0;n<s.length;n++)if(e=s[n]+a,e in i)return e;return null}},s={data:function(t,e){return"string"!=typeof t?null:(this.storage=this.storage||{},1===arguments.length?this.storage.hasOwnProperty(t)?this.storage[t]:null:void(this.storage[t]=o.clone(e,!0)))}};t.Presentr=e}(window);